---
- hosts: localhost
  become: yes
  
  tasks:

    - name: Copy Zabbix rpm locally
      ansible.builtin.copy:
        src: /<source>/zabbix-release-6.2-3.el7.noarch.rpm
        dest: /<dest>/zabbix-release-6.2-3.el7.noarch.rpm
        owner: root
        group: root
        mode: '0744'

    - name: Install Zabbix Repo
      ansible.builtin.yum:
        name: /<local file dest>/zabbix-release-6.2-3.el7.noarch.rpm
        state: present

    - name: Install zabbix-agent2
      yum:
        name: zabbix-agent2
        state: present

    - name: Install zabbix-agent2-plugins
      yum:
        name: zabbix-agent2-plugin-*
        state: present

    - name: Copy zabbix configuration file
      ansible.builtin.copy:
        src: <insert local source location here>
        dest: /etc/zabbix/zabbix_agent2.conf
        owner: root
        group: root
        mode: '0644'

    - name: Ensure zabbix-agent2 is installed
      yum:
        name: zabbix-agent2
        state: present

    - service:
        name: zabbix-agent2
        state: restarted

    - name: Ensure zabbix-agent2 is started and enabled
      service:
        name: zabbix-agent2
        state: started
        enabled: yes

        
